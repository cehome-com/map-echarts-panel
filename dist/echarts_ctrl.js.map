{"version":3,"sources":["../src/echarts_ctrl.js"],"names":["MetricsPanelCtrl","_","echarts","EchartsCtrl","$scope","$injector","panelDefaults","EchartsOption","IS_MAP","map","METHODS","USE_URL","USE_FAKE_DATA","fakeData","url","method","params","updateInterval","provinces","maps","paramValue","defaults","panel","events","on","onDataReceived","bind","onDataError","onInitEditMode","render","updateData","that","urlData","xmlhttp","data","eval","window","XMLHttpRequest","ActiveXObject","onreadystatechange","readyState","status","JSON","parse","responseText","items","open","send","setRequestHeader","$timeout","dataList","IS_DATA_CHANGED","addEditorTab","mapCode","name","myChart","$","get","registerMap","option","title","text","left","textStyle","color","fontSize","geo","itemStyle","normal","areaColor","borderColor","emphasis","label","show","backgroundColor","series","type","coordinateSystem","symbol","symbolSize","mapLocation","y","x","height","setOption","scope","elem","attrs","ctrl","$panelContainer","find","echartsData","init","setTimeout","resize","clear","loadMap","timeFn","clearTimeout","renderingCompleted","templateUrl"],"mappings":"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","file":"echarts_ctrl.js","sourcesContent":["import { MetricsPanelCtrl } from 'app/plugins/sdk'; // eslint-disable-line\r\nimport _ from 'lodash';\r\nimport echarts from './libs/echarts.min'; // eslint-disable-line\r\nimport './libs/echarts-liquidfill.min'; // eslint-disable-line\r\nimport './libs/echarts-wordcloud.min'; // eslint-disable-line\r\nimport './libs/dark'; // eslint-disable-line\r\nimport './css/style.css!'; // eslint-disable-line\r\n//import './libs/bmap.js'; // eslint-disable-line\r\nimport './libs/china.js' // eslint-disable-line\r\n//import './libs/beijing.js'// eslint-disable-line\r\n//import './libs/jiangxi.js'// eslint-disable-line\r\n//import './libs/getBmap.js'; // eslint-disable-line\r\n\r\nexport class EchartsCtrl extends MetricsPanelCtrl { // eslint-disable-line\r\n\r\n  constructor($scope, $injector) {\r\n    super($scope, $injector);\r\n\r\n    const panelDefaults = {\r\n      EchartsOption: 'console.log(JSON.stringify(echartsData));\\n\\noption = {};',\r\n      IS_MAP: false,\r\n      map: '',\r\n      METHODS: ['POST', 'GET'],\r\n      USE_URL: false,\r\n      USE_FAKE_DATA: true,\r\n      fakeData: '',\r\n      url: '',\r\n      method: 'GET',\r\n      params: '',\r\n      updateInterval: 10000,\r\n    };\r\n\r\n    this.provinces = {\r\n             '上海': 'public/plugins/map-echarts-panel/libs/data-1482909900836-H1BC_1WHg.json',\r\n             '河北': 'public/plugins/map-echarts-panel/libs/data-1482909799572-Hkgu_yWSg.json',\r\n             '山西': 'public/plugins/map-echarts-panel/libs/data-1482909909703-SyCA_JbSg.json',\r\n             '内蒙古': 'public/plugins/map-echarts-panel/libs/data-1482909841923-rkqqdyZSe.json',\r\n             '辽宁': 'public/plugins/map-echarts-panel/libs/data-1482909836074-rJV9O1-Hg.json',\r\n             '吉林': 'public/plugins/map-echarts-panel/libs/data-1482909832739-rJ-cdy-Hx.json',\r\n             '黑龙江': 'public/plugins/map-echarts-panel/libs/data-1482909803892-Hy4__J-Sx.json',\r\n             '江苏': 'public/plugins/map-echarts-panel/libs/data-1482909823260-HkDtOJZBx.json',\r\n             '浙江': 'public/plugins/map-echarts-panel/libs/data-1482909960637-rkZMYkZBx.json',\r\n             '安徽': 'public/plugins/map-echarts-panel/libs/data-1482909768458-HJlU_yWBe.json',\r\n             '福建': 'public/plugins/map-echarts-panel/libs/data-1478782908884-B1H6yezWe.json',\r\n             '江西': 'public/plugins/map-echarts-panel/libs/data-1482909827542-r12YOJWHe.json',\r\n             '山东': 'public/plugins/map-echarts-panel/libs/data-1482909892121-BJ3auk-Se.json',\r\n             '河南': 'public/plugins/map-echarts-panel/libs/data-1482909807135-SJPudkWre.json',\r\n             '湖北': 'public/plugins/map-echarts-panel/libs/data-1482909813213-Hy6u_kbrl.json',\r\n             '湖南': 'public/plugins/map-echarts-panel/libs/data-1482909818685-H17FOkZSl.json',\r\n             '广东': 'public/plugins/map-echarts-panel/libs/data-1482909784051-BJgwuy-Sl.json',\r\n             '广西': 'public/plugins/map-echarts-panel/libs/data-1482909787648-SyEPuJbSg.json',\r\n             '海南': 'public/plugins/map-echarts-panel/libs/data-1482909796480-H12P_J-Bg.json',\r\n             '四川': 'public/plugins/map-echarts-panel/libs/data-1482909931094-H17eKk-rg.json',\r\n             '贵州': 'public/plugins/map-echarts-panel/libs/data-1482909791334-Bkwvd1bBe.json',\r\n             '云南': 'public/plugins/map-echarts-panel/libs/data-1482909957601-HkA-FyWSx.json',\r\n             '西藏': 'public/plugins/map-echarts-panel/libs/data-1482927407942-SkOV6Qbrl.json',\r\n             '陕西': 'public/plugins/map-echarts-panel/libs/data-1482909918961-BJw1FyZHg.json',\r\n             '甘肃': 'public/plugins/map-echarts-panel/libs/data-1482909780863-r1aIdyWHl.json',\r\n             '青海': 'public/plugins/map-echarts-panel/libs/data-1482909853618-B1IiOyZSl.json',\r\n             '宁夏': 'public/plugins/map-echarts-panel/libs/data-1482909848690-HJWiuy-Bg.json',\r\n             '新疆': 'public/plugins/map-echarts-panel/libs/data-1482909952731-B1YZKkbBx.json',\r\n             '北京': 'public/plugins/map-echarts-panel/libs/data-1482818963027-Hko9SKJrg.json',\r\n             '天津': 'public/plugins/map-echarts-panel/libs/data-1482909944620-r1-WKyWHg.json',\r\n             '重庆': 'public/plugins/map-echarts-panel/libs/data-1482909775470-HJDIdk-Se.json',\r\n             '香港': 'public/plugins/map-echarts-panel/libs/data-1461584707906-r1hSmtsx.json',\r\n             '澳门': 'public/plugins/map-echarts-panel/libs/data-1482909771696-ByVIdJWBx.json'\r\n         };\r\n\r\n    this.maps = ['世界', '中国', '河北'];\r\n\r\n    this.paramValue = '';\r\n\r\n    _.defaults(this.panel, panelDefaults);\r\n\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('data-error', this.onDataError.bind(this));\r\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    this.events.on('panel-initialized', this.render.bind(this));\r\n\r\n    this.updateData();\r\n  }\r\n\r\n  //请求\r\n  updateData() {\r\n    const that = this;\r\n    let urlData;\r\n    let xmlhttp;\r\n    if (this.panel.USE_URL && this.panel.USE_FAKE_DATA && this.panel.fakeData) {\r\n      this.data = eval(this.panel.fakeData);\r\n    } else if (that.panel.USE_URL && !that.panel.USE_FAKE_DATA && that.panel.url && that.panel.method) {\r\n      if (window.XMLHttpRequest) {\r\n        xmlhttp = new XMLHttpRequest();\r\n      } else {\r\n        xmlhttp = new ActiveXObject('Microsoft.XMLHTTP'); // eslint-disable-line\r\n      }\r\n      xmlhttp.onreadystatechange = () => {\r\n        if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {\r\n          urlData = JSON.parse(xmlhttp.responseText);\r\n          that.data = urlData.items;\r\n          that.onDataReceived();\r\n        }\r\n      };\r\n      if(that.panel.method == 'GET'){\r\n          if(that.paramValue == ''){\r\n            xmlhttp.open(that.panel.method, that.panel.url, true);\r\n          }else{\r\n            xmlhttp.open(that.panel.method, that.panel.url + that.paramValue, true);\r\n          }\r\n          xmlhttp.send();\r\n      }else{\r\n        xmlhttp.open(that.panel.method, that.panel.url, true);\r\n        xmlhttp.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");\r\n        xmlhttp.send(that.panel.params);\r\n      }\r\n\r\n    } else {\r\n      xmlhttp = null;\r\n    }\r\n    this.$timeout(() => { this.updateData(); }, that.panel.updateInterval);\r\n  }\r\n\r\n  onDataReceived(dataList) {\r\n    this.data = !this.panel.USE_URL && !this.panel.USE_FAKE_DATA ? dataList : this.data;\r\n//    alert('onDataReceived-----' + JSON.stringify(this.data))\r\n    this.IS_DATA_CHANGED = true;\r\n    this.render();\r\n    this.IS_DATA_CHANGED = false;\r\n  }\r\n\r\n  onDataError() {\r\n    this.render();\r\n  }\r\n\r\n  onInitEditMode() {\r\n    this.addEditorTab('Data Source', 'public/plugins/map-echarts-panel/partials/editer-metric.html', 2);\r\n    this.addEditorTab('Ecahrts Configuration', 'public/plugins/map-echarts-panel/partials/editor-echarts.html', 3);\r\n  }\r\n\r\n  loadMap(mapCode,name,myChart) {\r\n     let that = this;\r\n      $.get(mapCode, function(data) {\r\n          if (data) {\r\n              echarts.registerMap(name, data);\r\n              var option = {\r\n                  title : {\r\n                      text: name,\r\n                      left: 'center',\r\n                      textStyle:{color:'#ffffff',fontSize:12}\r\n                  },\r\n                  geo: {\r\n                      map: name,\r\n                      itemStyle: {\r\n                          normal: {areaColor: '#3a8eff' ,borderColor:'#3a8eff'},\r\n                          emphasis: {areaColor: '#3a8eff' }\r\n                      },\r\n                      label: {\r\n                          normal: {\r\n                              show: false\r\n                          },\r\n                          emphasis: {\r\n                              show: false\r\n                          }\r\n                      }\r\n                  },\r\n                  backgroundColor: '#21242b',\r\n                  series: [\r\n                      {\r\n                          type: 'scatter',\r\n                          coordinateSystem: 'geo',\r\n                          symbol:'pin',\r\n                          symbolSize:12,\r\n                          mapLocation: {\r\n                            y: \"center\",\r\n                            x: \"center\",\r\n                            height: \"380\"\r\n                          },\r\n                          data:that.data\r\n\r\n                      }\r\n                  ]\r\n              };\r\n              myChart.setOption(option);\r\n          } else {\r\n//              alert('无法加载该地图');\r\n          }\r\n      });\r\n  }\r\n\r\n  link(scope, elem, attrs, ctrl) {\r\n    const $panelContainer = elem.find('.echarts_container')[0];\r\n    let option = {}; // eslint-disable-line\r\n    let echartsData = []; // eslint-disable-line\r\n\r\n    ctrl.IS_DATA_CHANGED = true;\r\n\r\n    const myChart = echarts.init($panelContainer, 'dark');\r\n\r\n    // bad hank\r\n    setTimeout(() => {\r\n      myChart.resize();\r\n    }, 1000);\r\n\r\n    function render() {\r\n      if (!myChart) {\r\n        return;\r\n      }\r\n      if (ctrl.IS_DATA_CHANGED) {\r\n         myChart.clear();\r\n        if(ctrl.paramValue == ''){\r\n            echartsData = ctrl.data;\r\n            eval(ctrl.panel.EchartsOption);\r\n            myChart.setOption(option);\r\n        }else{\r\n            let mapCode = ctrl.provinces[ctrl.paramValue];\r\n            ctrl.loadMap(mapCode,ctrl.paramValue,myChart);\r\n        }\r\n      }\r\n      myChart.resize();\r\n    }\r\n\r\n    let timeFn = null;\r\n\r\n    //单击切换到省级地图，当mapCode有值,说明可以切换到下级地图\r\n    myChart.on('click', function(params) {\r\n        clearTimeout(timeFn);\r\n        //由于单击事件和双击事件冲突，故单击的响应事件延迟250毫秒执行\r\n        timeFn = setTimeout(function() {\r\n            var name = params.name; //地区name\r\n            var mapCode = ctrl.provinces[name]; //地区的json数据\r\n            if (!mapCode) {\r\n                return;\r\n            }\r\n            ctrl.paramValue = name;\r\n            ctrl.updateData();\r\n            ctrl.loadMap(mapCode,name,myChart);\r\n            myChart.resize();\r\n        }, 100);\r\n    });\r\n\r\n    // 绑定双击事件，返回全国地图\r\n    myChart.on('dblclick', function(params) {\r\n        clearTimeout(timeFn);\r\n        ctrl.paramValue = '';\r\n        //返回全国地图\r\n        ctrl.updateData();\r\n    });\r\n\r\n    this.events.on('render', () => {\r\n      render();\r\n      ctrl.renderingCompleted();\r\n    });\r\n  }\r\n}\r\n\r\nEchartsCtrl.templateUrl = 'module.html';\r\n"]}